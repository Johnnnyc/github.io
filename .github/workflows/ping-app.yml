name: Ping App

on:
  schedule:
    # 每4分钟运行一次
    - cron: '*/4 * * * *'
  workflow_dispatch:
    # 允许手动触发

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping health endpoint
        run: |
          # 替换为你的Replit应用URL
          REPLIT_URL="https://6be552f2-d09f-4d23-9505-58846266f57b-00-51bi4tpuumjw.sisko.replit.dev:3000"
          
          # 记录开始时间
          echo "[$(date '+%Y-%m-%d %H:%M:%S')] Starting ping to $REPLIT_URL/health"
          
          # 向健康检查端点发送请求，记录详细信息
          response=$(curl -s -w "%{http_code}" -o /dev/null "$REPLIT_URL/health")
          
          # 记录响应状态
          echo "[$(date '+%Y-%m-%d %H:%M:%S')] Ping response: $response"
          
          # 检查响应状态
          if [ "$response" -eq 200 ]; then
            echo "[$(date '+%Y-%m-%d %H:%M:%S')] Ping successful!"
          else
            echo "[$(date '+%Y-%m-%d %H:%M:%S')] Ping failed with status code: $response"
            exit 1
          fi
          
          echo "[$(date '+%Y-%m-%d %H:%M:%S')] Ping completed."
